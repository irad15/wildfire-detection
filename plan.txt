# Wildfire Detection System - Current Implementation

## Project Overview

This is a real-time wildfire detection system built with FastAPI that processes environmental sensor data to identify potential fire events. The system analyzes temperature, smoke density, and wind speed measurements to detect anomalous patterns that may indicate wildfires.

### Key Features
- **Real-time Processing**: Accepts JSON arrays of sensor readings via REST API
- **Advanced Signal Processing**: Uses Savitzky-Golay filtering for noise reduction
- **Intelligent Anomaly Detection**: Dynamic variance-stabilized scoring algorithm
- **Risk-based Alerting**: Configurable thresholds for event detection
- **Comprehensive Validation**: Pydantic models ensure data integrity

## Architecture

```
wildfire-detection/
├── main.py                    # FastAPI application entry point
├── api/
│   ├── __init__.py
│   └── router.py              # REST API endpoints (/detect, /health)
├── core/                      # Business logic layer
│   ├── __init__.py
│   ├── models.py              # Pydantic data models (DataPoint, Event, EventsSummary)
│   ├── data_processor.py      # Signal processing and smoothing
│   ├── event_detector.py      # Anomaly detection and scoring
│   └── detection_service.py   # High-level orchestration service
├── data/                      # Sample input files for testing
│   ├── sample_input1.json     # Gradual temperature/smoke increase
│   ├── sample_input1Spike.json # Sudden spike scenario
│   ├── sample_input2.json     # Different gradual increase pattern
│   ├── sample_input2Rise.json # Moderate rise scenario
│   ├── sample_inputflat.json  # Baseline stable readings
│   ├── sample_inputflatRise.json # Stable with slight rise
│   └── sample_inputflatSpike.json # Stable with sudden spike
└── tests/                     # Test suite
    ├── api/test_router.py
    └── core/
        ├── test_data_processor.py
        └── test_event_detector.py
    └── integration/
        └── test_fire_scenarios.py
        
```

## API Endpoints

### POST /detect
**Input**: Array of sensor readings
```json
[
  {
    "timestamp": "2025-08-01T00:00:00Z",
    "temperature": 22.5,
    "smoke": 0.01,
    "wind": 2.3
  }
]
```

**Output**: Event detection summary
```json
{
  "events": [
    {
      "timestamp": "2025-08-01T00:15:00Z",
      "score": 85.7
    }
  ],
  "event_count": 1,
  "max_score": 85.7
}
```

### GET /health
**Output**: Service health status
```json
{"status": "ok"}
```

## Processing Pipeline

### 1. Data Processing (DataProcessor)
- **Input Validation**: Pydantic models validate timestamp format (ISO-8601) and physical constraints
- **Chronological Sorting**: Ensures data is processed in time order
- **Signal Extraction**: Converts data to NumPy arrays for vectorized operations
- **Savitzky-Golay Smoothing**:
  - Window size: 13 points (must be odd)
  - Polynomial order: 2
  - Applied to temperature and smoke signals
  - Fallback to original data for short sequences
- **Physical Bounds Enforcement**:
  - Temperature: ≥ 0°C (no negative values)
  - Smoke: 0.0 - 1.0 (normalized range)

### 2. Event Detection (EventDetector)
The detection algorithm uses sophisticated statistical anomaly detection with dynamic variance stabilization:

#### Dynamic Variance-Stabilized Anomaly Detection
- **Global Statistics**: Computes mean and standard deviation for temperature and smoke
- **Variance-Aware Damping**:
  - **Temperature Damping**: Sigmoid function prevents false positives in low-variance data
  - **Smoke Damping**: Power-law function adapts to noise levels
- **Z-Score Calculation**: Measures deviation from baseline for each sensor
- **Weighted Risk Scoring**:
  - Temperature anomaly: 40% weight
  - Smoke anomaly: 50% weight
  - Wind contribution: 10% base + wind multiplier
  - Wind multiplier: 1.0 + (wind_speed / 15.0)

#### Risk Score Formula
```
temp_z = max(0, (temp - mean_temp) / std_temp)
smoke_z = max(0, (smoke - mean_smoke) / std_smoke)

temp_anomaly = temp_z * temp_damping
smoke_anomaly = smoke_z * smoke_damping

base_score = 40 × temp_anomaly + 50 × smoke_anomaly + 10 × (wind / 2)
risk_score = min(100.0, max(0.0, base_score × wind_multiplier))
```

#### Alert Threshold
- **Event Trigger**: risk_score > 70
- **Output**: EventsSummary with event list, count, and maximum score

## Technical Implementation Details

### Signal Processing
- **Library**: SciPy's Savitzky-Golay filter for robust smoothing
- **Edge Handling**: Window size adapts to data length
- **Vectorization**: NumPy arrays for efficient computation

### Anomaly Detection Algorithm
- **Dynamic Adaptation**: Algorithm adjusts sensitivity based on data variance
- **False Positive Reduction**: Damping functions prevent alerts in stable conditions
- **Wind Integration**: Environmental factors amplify risk assessment

### Data Models
- **DataPoint**: Input sensor reading with validation
- **Event**: Detected anomaly with timestamp and risk score
- **EventsSummary**: Collection of events with metadata

## Usage Examples

### Running the Service
```bash
uvicorn main:app --reload
```

### Testing with Sample Data
```bash
curl -X POST "http://localhost:8000/detect" \
  -H "Content-Type: application/json" \
  -d @data/sample_input1Spike.json
```

## Key Algorithm Insights

1. **Variance Stabilization**: Low-variance data gets damped to prevent noise-triggered alerts
2. **Multi-Sensor Fusion**: Combines temperature, smoke, and wind for robust detection
3. **Adaptive Thresholding**: No hardcoded thresholds - adapts to environmental conditions
4. **Risk Quantification**: Scores provide actionable risk levels (0-100)

This implementation provides a production-ready wildfire detection system with advanced signal processing and intelligent anomaly detection capabilities.